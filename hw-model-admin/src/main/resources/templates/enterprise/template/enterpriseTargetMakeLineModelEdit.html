<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<meta charset="utf-8" content="multipart/form-data">
<head th:include="include :: header"></head>
<body>
    <div class="form-content">
        <form class="form-horizontal" id="form-enterpriseTargetMakeLineModel-edit"  th:object="${enterpriseTargetMakeLineModel}" >
            <input name="enterpriseTargetMakeLineModelId" type="hidden" th:field="*{enterpriseTargetMakeLineModelId}">
            <h4 class="form-header h4">企业指标标记线模型基本信息</h4>
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label"><span style="color: red; ">*</span>平台指标模型：</label>
                        <div class="col-sm-8">
                            <div class="input-group" style="width: 100%">
                                <select id="targetModelSelect" name="targetModelId" class="form-control m-b" th:with="targetModelList=${targetModelList}" required>
                                    <option value="">未选择</option>
                                    <option th:each="targetModel : ${targetModelList}" th:text="${targetModel.name}" th:value="${targetModel.targetModelId}" th:field="*{targetModelId}"></option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label"><span style="color: red; ">*</span>平台指标展示模型：</label>
                        <div class="col-sm-8">
                            <div class="input-group" style="width: 100%">
                                <select id="targetModelTempSelect" name="targetModelTemplateId" class="form-control m-b" th:with="targetModelTempList=${targetModelTempList}" required>
                                    <option th:each="targetModelTemp : ${targetModelTempList}" th:text="${targetModelTemp.name}" th:value="${targetModelTemp.targetModelTemplateId}" th:field="*{targetModelTemplateId}"></option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label"><span style="color: red; ">*</span>平台指标标记线模型：</label>
                        <div class="col-sm-8">
                            <div class="input-group" style="width: 100%">
                                <select id="targetMakeLineModelSelect" name="targetMakeLineModelId" class="form-control m-b" th:with="makeLineList=${makeLineList}" required>
                                    <option th:each="makeLine : ${makeLineList}" th:text="${makeLine.lineName}" th:value="${makeLine.targetMakeLineModelId}" th:field="*{targetMakeLineModelId}"></option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label"><span style="color: red; ">*</span>标记线名称：</label>
                        <div class="col-sm-8">
                            <input name="lineName" autocomplete="off" class="form-control lineName" type="text" maxlength="40" th:field="*{lineName}" >
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">标记值：</label>
                        <div class="col-sm-8">
                            <input name="markValue" autocomplete="off" class="form-control markValue" type="text" maxlength="10" th:field="*{markValue}" >
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">描述：</label>
                        <div class="col-sm-8">
                            <input name="description" autocomplete="off" class="form-control description" type="text" maxlength="80" th:field="*{description}" >
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="row">
        <div class="col-sm-offset-5 col-sm-10">
            <button type="button" class="btn btn-sm btn-primary" onclick="submitHandler()"><i class="fa fa-check"></i>保 存</button>&nbsp;
            <button type="button" class="btn btn-sm btn-danger" onclick="closeItem()"><i class="fa fa-reply-all"></i>关 闭 </button>
        </div>
    </div>
	<div th:include="include::footer"></div>
	<script th:src="@{/ajax/libs/select/select2.js}"></script>
	<script>
        function submitHandler() {
            if ($.validate.form()) {
                var data = $("#form-enterpriseTargetMakeLineModel-edit").serializeArray();
                $.operate.saveTab(ctx + "enterprise/targetMakeLine/editSave", data);
            }
        }
        $('#targetModelSelect').change(function () {
            var currentTargetModelId = $(this).children('option:selected').val();
            if ($.common.isEmpty(currentTargetModelId)) {
                $.modal.alertWarning("请先选择平台指标模型");
                return;
            }
            $.ajax({
                url: ctx + "getTargetModelTempList",
                type: "POST",
                data: "targetModelId=" +  currentTargetModelId,
                success: function (result) {
                    var targetModelTempSelect = document.getElementById('targetModelTempSelect');
                    targetModelTempSelect.removeAttribute("disabled");
                    targetModelTempSelect.innerHTML = '';
                    targetModelTempSelect.append(new Option("未选择", ""));
                    $.each(result.targetModelTempList,function (index, targetModelTemp) {
                        targetModelTempSelect.options.add(new Option(targetModelTemp.name,targetModelTemp.targetModelTemplateId));
                    });
                }
            });
        });

        $('#targetModelTempSelect').change(function () {
            var currentTargetModelTempId = $(this).children('option:selected').val();
            if ($.common.isEmpty(currentTargetModelTempId)) {
                $.modal.alertWarning("请先选择平台指标展示模型");
                return;
            }
            $.ajax({
                url: ctx + "getMakeLineList",
                type: "POST",
                data: "targetModelTempId=" +  currentTargetModelTempId,
                success: function (result) {
                    var targetMakeLineModelSelect = document.getElementById('targetMakeLineModelSelect');
                    targetMakeLineModelSelect.removeAttribute("disabled");
                    targetMakeLineModelSelect.innerHTML = '';
                    targetMakeLineModelSelect.append(new Option("未选择", ""));
                    $.each(result.makeLineList,function (index, makeLine) {
                        targetMakeLineModelSelect.options.add(new Option(makeLine.lineName,makeLine.targetMakeLineModelId));
                    });
                }
            });
        });

        $('#targetMakeLineModelSelect').change(function () {
            var currentTargetMakeLineModelId = $(this).children('option:selected').val();
            if ($.common.isEmpty(currentTargetMakeLineModelId)) {
                $.modal.alertWarning("请选择平台指标标记线模型");
                return;
            }
            $.ajax({
                url: ctx + "targetMakeLineModel/findOneById",
                type: "POST",
                data: "targetMakeLineModelId=" +  currentTargetMakeLineModelId,
                success: function (result) {
                    var lineNameElement = document.getElementsByClassName("lineName")[0];
                    var markValueElement = document.getElementsByClassName("markValue")[0];
                    var descriptionElement = document.getElementsByClassName("description")[0];
                    lineNameElement.value = result.targetMakeLineModel.lineName;
                    markValueElement.value = result.targetMakeLineModel.defaultValue;markValueElement.removeAttribute("readonly");
                    descriptionElement.value = result.targetMakeLineModel.description;
                }
            });
        });
    </script>
</body>
</html>